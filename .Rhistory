tidied_data %>%
filter(type == "confirmed") %>%
group_by(higher, date) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>%
arrange(date) %>%
filter(n >= 50) %>%
mutate(first_date = date[1]) %>%
mutate(days_since_first = date - first_date) %>%
ungroup() %>%
ggplot(aes(x = days_since_first, y = n, group = higher)) +
geom_line() +
scale_y_log10() +
facet_wrap(~higher)
tidied_data %>%
filter(type == "confirmed") %>%
group_by(higher, date) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>%
arrange(date) %>%
filter(n >= 100) %>%
mutate(first_date = date[1]) %>%
mutate(days_since_first = date - first_date) %>%
ungroup() %>%
ggplot(aes(x = days_since_first, y = n, group = higher)) +
geom_line() +
scale_y_log10() +
facet_wrap(~higher)
tidied_data %>%
filter(type == "confirmed") %>%
group_by(higher, date) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>%
arrange(date) %>%
filter(n >= 100) %>%
mutate(first_date = date[1]) %>%
mutate(days_since_first = date - first_date) %>%
mutate(max_days_since_first = max(days_since_first)) %>%
ungroup() %>%
mutate(country = fct_reorder(higher, desc(max_days_since_first))) %>%
ggplot(aes(x = days_since_first, y = n)) +
geom_line() +
scale_y_log10() +
facet_wrap(~country)
tidied_data %>%
filter(type == "confirmed") %>%
group_by(higher, date) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>%
arrange(date) %>%
filter(n >= 100) %>%
mutate(first_date = date[1]) %>%
mutate(days_since_first = date - first_date) %>%
mutate(max_days_since_first = max(days_since_first)) %>%
ungroup() %>%
mutate(country = fct_reorder(higher, desc(max_days_since_first))) %>%
filter(country != "Others") %>%
ggplot(aes(x = days_since_first, y = n)) +
geom_line() +
scale_y_log10() +
facet_wrap(~country)
tidied_data %>%
filter(type == "confirmed") %>%
group_by(higher, date) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>%
arrange(date) %>%
filter(n >= 100) %>%
mutate(first_date = date[1]) %>%
mutate(days_since_first = date - first_date) %>%
mutate(max_days_since_first = max(days_since_first)) %>%
ungroup() %>%
mutate(country = fct_reorder(higher, desc(max_days_since_first))) %>%
filter(country != "Others") %>%
ggplot(aes(x = days_since_first, y = n)) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
facet_wrap(~country) +
labs(
title = "Confirmed cases after first 100 cases",
subtitle = "Arranged by number of days since 100 or more cases",
x = "Days after 100 confirmed cases",
y = "Confirmed cases (log scale)",
caption = "Source: Johns Hopkins CSSE"
)
ggsave(here("figures", "days_since_100.png"), height = 20, width = 20, units = "cm", dpi = 300)
tidied_data %>%
filter(type == "confirmed") %>%
group_by(higher, date) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>%
arrange(date) %>%
filter(n >= 100) %>%
mutate(first_date = date[1]) %>%
mutate(days_since_first = date - first_date) %>%
mutate(max_days_since_first = max(days_since_first)) %>%
ungroup() %>%
mutate(country = fct_reorder(higher, desc(max_days_since_first))) %>%
filter(country != "Others") %>%
ggplot(aes(x = days_since_first, y = n)) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
facet_wrap(~country) +
labs(
title = "Confirmed cases after first 100 cases",
subtitle = "Arranged by number of days since 100 or more cases",
x = "Days after 100 confirmed cases",
y = "Confirmed cases (log scale)",
caption = "Source: Johns Hopkins CSSE"
)
ggsave("figures/days_since_100.png", height = 20, width = 20, units = "cm", dpi = 300)
ls()
ls()
tidied_data
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere"))
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup()
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100)
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
ggplot(aes(x = date, y = n, group = type, linetype = type)) +
geom_line() +
facet_wrap(~china)
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
ggplot(aes(x = date, y = n, group = type, linetype = type)) +
geom_line() +
facet_wrap(~china) +
scale_y_log10()
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
ggplot(aes(x = date, y = n, group = type, linetype = type)) +
geom_line() +
facet_wrap(~china) +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
)
pacman::p_load(tidyverse, here, ggrepel, lubridate, drc)
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed")
model <- drm(Y ~ X, fct = DRC.asymReg())
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed")
#model <- drm(Y ~ X, fct = DRC.asymReg())
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(chine == "China")
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China")
#model <- drm(Y ~ X, fct = DRC.asymReg())
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date)
#model <- drm(Y ~ X, fct = DRC.asymReg())
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
#model <- drm(Y ~ X, fct = DRC.asymReg())
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date)) %>%
drm(n ~ days_since_start, fct - DRC.asymReg, data = .)
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date)) %>%
drm(n ~ days_since_start, fct = DRC.asymReg, data = .)
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date)) %>%
drm(n ~ days_since_start, fct = DRC.asymReg(), data = .)
pacman::p_load(tidyverse, here, ggrepel, lubridate, drc, aomisc)
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date)) %>%
drm(n ~ days_since_start, fct = DRC.asymReg(), data = .)
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date)) %>%
drm(n ~ days_since_start, fct = aomisc::DRC.asymReg(), data = .)
pacman::p_load(tidyverse, here, ggrepel, lubridate, drc, aomisc)
install.packages("aomisc")
?drm
?nls
data("Loblolly")
Lob.329 <- Loblolly[Loblolly$Seed == "329",]
Lob.329
NLSstAsymptotic(sortedXyData(expression(age), expression(height), Lob.329))
?sortedXyData
NLSstAsymptotic(sortedXyData(expression(age), expression(height), Lob.329))
sortedXyData(expression(age), expression(height), Lob.329)
expression()
?expression()
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
sortedXyData(expression(days_since_start), expression(n), dta_china)
NLSstAsymptotic(
sortedXyData(expression(days_since_start), expression(n), dta_china)
)
start_vals <-
NLSstAsymptotic(
sortedXyData(expression(days_since_start), expression(n), dta_china)
)
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
start_vals <-
NLSstAsymptotic(
sortedXyData(expression(days_since_start), expression(n), dta_china)
)
nls_mod <- nls(n ~ SSasymp(days_since_start, start_vals$b1, start_vals$b0, start_vals$lrc), data = dta_china)
start_vals
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
start_vals <-
NLSstAsymptotic(
sortedXyData(expression(days_since_start), expression(n), dta_china)
)
nls_mod <- nls(n ~ SSasymp(days_since_start, start_vals$b1, 500, start_vals$lrc), data = dta_china)
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
start_vals <-
NLSstAsymptotic(
sortedXyData(expression(days_since_start), expression(n), dta_china)
)
nls_mod <- nls(n ~ SSasymp(days_since_start, start_vals[["b1"]], 500, start_vals[["lrc"]]), data = dta_china)
sortedXyData(expression(days_since_start), expression(n), dta_china)
xy_china <- sortedXyData(expression(days_since_start), expression(n), dta_china)
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
start_vals <-
NLSstAsymptotic(
sortedXyData(expression(days_since_start), expression(n), dta_china)
)
xy_china <- sortedXyData(expression(days_since_start), expression(n), dta_china)
nls_mod <- nls(y ~ SSasymp(x, start_vals[["b1"]], 500, start_vals[["lrc"]]), data = xy_china)
start_vals
start_vals[["b0"]]
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
start_vals <-
NLSstAsymptotic(
sortedXyData(expression(days_since_start), expression(n), dta_china)
)
xy_china <- sortedXyData(expression(days_since_start), expression(n), dta_china)
nls_mod <- nls(y ~ SSasymp(x, start_vals[["b1"]], start_vals[["b0"]], start_vals[["lrc"]]), data = xy_china)
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
china_xy <- sortedXyData(expression(days_since_start), expression(n), dta_china)
china_xy
summary(lm(log(y) ~ x, china_xy) )
dta_china <-
tidied_data %>%
mutate(china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
filter(n >= 100) %>%
filter(type == "confirmed") %>%
filter(china == "China") %>%
arrange(date) %>%
mutate(days_since_start = date - min(date))
china_xy <- sortedXyData(expression(days_since_start), expression(n), dta_china)
china_xy
lns(y ~ SSasymp(x, 81000, 500, 0.1), china_xy)
nls(y ~ SSasymp(x, 81000, 500, 0.1), china_xy)
nls(y ~ SSasymp(x, 81000, 500, -0.1), china_xy)
plot(china_xy$x, china_xy$y)
curve(fx(1:50, 85000, 500, -0.1))
plot(china_xy$x, china_xy$y)
curve(fx(x = 1:50, 85000, 500, -0.1), add = T)
fx(x = 1:50, 85000, 500, -0.1)
fx <- function(x, Asym, R0, lrc){asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
curve(fx(x = 1:50, 85000, 500, -0.1), add = T)
fx(x = 1:50, 85000, 500, -0.1)
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
curve(fx(x = 1:50, 85000, 500, -0.1), add = T)
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
curve(fx(x = 1:50, 85000, 500, -0.1), add = T)
curve(fx(1:50, 85000, 500, -0.1), add = T)
curve(fx(china_xy$x, 85000, 500, -0.1), add = T)
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
curve(fx(china_xy$x, 85000, 500, -0.1), add = T)
fx(china_xy$x, 85000, 500, -0.1)
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
curve(china_xy$x, fx(china_xy$x, 85000, 500, -0.1), add = T)
dim(china_xy)
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -0.1), add = T)
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -0.1))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -0.01))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -0.2))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -2))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -5))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -3))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -4))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -2.5))
fx <- function(x, Asym, R0, lrc){Asym + (R0-Asym) * exp(-exp(lrc)*x)}
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x, 85000, 500, -2.5))
nls_mod <- nls(y ~ fx(x, Asym, R0, lrc),
data = china_xy,
start = list(Aym = 85000, lrc = -2.5, R0 = 500)
)
nls_mod <- nls(y ~ fx(x, Asym, R0, lrc),
data = china_xy,
start = list(Asym = 85000, lrc = -2.5, R0 = 500)
)
summary(nls_mod)
coefficients(nls_mod)
plot(china_xy$x, china_xy$y)
lines(china_xy$x, fx(china_xy$x,
Asym = coefficients(nls_mod)[["Asym"]],
R0 = coefficients(nls_mod)[["R0"]],
lrc = coefficients(nls_mod)[["lrc"]]
)
)
