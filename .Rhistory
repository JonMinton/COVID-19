pacman::p_load(tidyverse)
pacman::p_load(tidyverse, here)
# Read one file to get structure
first_file <- read_csv(here("ccse_covid_19_data", "ccse_covide_19_daily_reports", "01-22-2020.csv"))
# Read one file to get structure
first_file <- read_csv(here("ccse_covid_19_data", "ccse_covid_19_daily_reports", "01-22-2020.csv"))
dir.exists(here("ccse_covid_19_data"))
# Read one file to get structure
first_file <- read_csv(here("csse_covid_19_data", "csse_covid_19_daily_reports", "01-22-2020.csv"))
first_file
#all_files <-
list.files(here("csse_covid_19_data", "csse_covid_19_daily_reports"))
#all_files <-
list.files(here("csse_covid_19_data", "csse_covid_19_daily_reports"), pattern = "\\.csv$")
tibble(
filename = all_files
)
all_files <-
list.files(here("csse_covid_19_data", "csse_covid_19_daily_reports"), pattern = "\\.csv$")
tibble(
filename = all_files
)
tibble(
filename = all_files
) %>%
mutate(
date = str_remove(filename, "\\.csv$")
)
tibble(
filename = all_files
) %>%
mutate(
date = str_remove(filename, "\\.csv$"),
loc = here("csse_covid_19_data", "csse_covid_19_daily_reports", filename)
)
dtablk <- tibble(
filename = all_files
) %>%
mutate(
date = str_remove(filename, "\\.csv$"),
loc = here("csse_covid_19_data", "csse_covid_19_daily_reports", filename)
) %>%
mutate(
data = map(loc, read_csv)
)
dtablk
all_files <-
list.files(here("csse_covid_19_data", "csse_covid_19_daily_reports"), pattern = "\\.csv$")
dtablk <- tibble(
filename = all_files
) %>%
mutate(
date = str_remove(filename, "\\.csv$"),
loc = here("csse_covid_19_data", "csse_covid_19_daily_reports", filename)
) %>%
mutate(
data = map(loc, read_csv)
) %>%
select(date, data) %>%
unnest(data)
?read_csv
all_files <-
list.files(here("csse_covid_19_data", "csse_covid_19_daily_reports"), pattern = "\\.csv$")
dtablk <- tibble(
filename = all_files
) %>%
mutate(
date = str_remove(filename, "\\.csv$"),
loc = here("csse_covid_19_data", "csse_covid_19_daily_reports", filename)
) %>%
mutate(
data = map(loc, read_csv, col_types = "cccddddd")
) %>%
select(date, data) %>%
unnest(data)
dtablk
all_files <-
list.files(here("csse_covid_19_data", "csse_covid_19_daily_reports"), pattern = "\\.csv$")
dtablk <- tibble(
filename = all_files
) %>%
mutate(
date = str_remove(filename, "\\.csv$"),
loc = here("csse_covid_19_data", "csse_covid_19_daily_reports", filename)
) %>%
mutate(
data = map(loc, read_csv)
) %>%
select(date, data) %>%
mutate(num_var = map_dbl(data, ncol))
dtablk
dtablk %>%
filter(num_var == 6) %>%
unnest(data)
dtablk %>%
filter(num_var == 8) %>%
unnest(data)
dtablk %>% slice(1) %>%
unnest(data)
dtablk %>%
mutate(dta_simple = map(data, ~ . %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered)))
dtablk %>%
mutate(dta_simple = map(data, ~ . %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple)
dtablk %>%
mutate(dta_simple = map(data, ~ . %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple)
dtablk %>%
mutate(dta_simple = map(data, ~ .x %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple)
dtablk %>%
filter(num_var == 6) %>%
unnest(data)
# Drop latitude, longitude, and last update
dtablk %>%
mutate(dta_simple = map(data, ~ .x %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple) %>%
gather(key = "type", value = n, Confirmed:Recovered)
# Drop latitude, longitude, and last update
dtablk %>%
mutate(dta_simple = map(data, ~ .x %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple) %>%
gather(key = "type", value = n, Confirmed:Recovered) %>%
mutate(n = ifelse(is.na(n), 0, n))
# Drop latitude, longitude, and last update
dtablk %>%
mutate(dta_simple = map(data, ~ .x %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple) %>%
gather(key = "type", value = n, Confirmed:Recovered) %>%
mutate(n = ifelse(is.na(n), 0, n)) %>%
mutate(date = mdy(date))
# Drop latitude, longitude, and last update
dtablk %>%
mutate(dta_simple = map(data, ~ .x %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple) %>%
gather(key = "type", value = n, Confirmed:Recovered) %>%
mutate(n = ifelse(is.na(n), 0, n)) %>%
mutate(date = lubridate::mdy(date))
# Drop latitude, longitude, and last update
tidied_data <-
dtablk %>%
mutate(dta_simple = map(data, ~ .x %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple) %>%
gather(key = "type", value = n, Confirmed:Recovered) %>%
mutate(n = ifelse(is.na(n), 0, n)) %>%
mutate(date = lubridate::mdy(date)) %>%
select(date, higher = `Province/State`, lower = `Country/Region`, type, n)
tidied_data
# Drop latitude, longitude, and last update
tidied_data <-
dtablk %>%
mutate(dta_simple = map(data, ~ .x %>% select(`Province/State`, `Country/Region`, Confirmed, Deaths, Recovered))) %>%
select(date, dta_simple) %>%
unnest(dta_simple) %>%
gather(key = "type", value = n, Confirmed:Recovered) %>%
mutate(n = ifelse(is.na(n), 0, n)) %>%
mutate(date = lubridate::mdy(date)) %>%
select(date, higher = `Province/State`, lower = `Country/Region`, type, n) %>%
mutate(type = tolower(type))
tidied_data
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date)
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) %>%
geom_point()
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point() +
scale_y_log10()
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10()
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10() +
scale_x_date()
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10() +
scale_x_date(date_breaks = "1 day")
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10() +
scale_x_date(date_breaks = "1 week") +
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10() +
scale_x_date(date_breaks = "1 week")
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10() +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = trans_breaks("log10", function(x) 10^x),
labels = trans_format("log10", math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
?lubridate::month
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
mutate(month = lubridate::month(date, label = TRUE)) %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
mutate(month = lubridate::month(date, label = TRUE)) %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) %>%
stat_smooth(
aes(group = month),
method = "lm", se = FALSE,
)
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
mutate(month = lubridate::month(date, label = TRUE)) %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
stat_smooth(
aes(group = month),
method = "lm", se = FALSE,
)
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
mutate(month = lubridate::month(date, label = TRUE)) %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
stat_smooth(
aes(group = month),
method = "lm", se = FALSE,
) +
labs(
x = "Date", y = "Total cases confirmed (log scale)",
title = "Total worldwide COVID-19 cases confirmed by date",
caption = "Source: Johns Hopkins CSSE"
)
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
mutate(month = lubridate::month(date, label = TRUE)) %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
stat_smooth(
aes(group = month),
method = "lm", se = FALSE,
) +
labs(
x = "Date", y = "Total cases confirmed (log scale)",
title = "Total worldwide COVID-19 cases confirmed by date after 15 Feb",
subtitle = "Log scale. Regression lines broken by month"
caption = "Source: Johns Hopkins CSSE"
tidied_data %>%
filter(type == "confirmed") %>%
filter(date > lubridate::dmy("15-02-2020")) %>%
group_by(date) %>%
summarise(total_confirmed = sum(n)) %>%
ungroup() %>%
mutate(month = lubridate::month(date, label = TRUE)) %>%
ggplot(aes(x = date, y = total_confirmed)) +
geom_point()  +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
scale_x_date(date_breaks = "1 day") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
stat_smooth(
aes(group = month),
method = "lm", se = FALSE,
) +
labs(
x = "Date", y = "Total cases confirmed (log scale)",
title = "Total worldwide COVID-19 cases confirmed by date after 15 Feb",
subtitle = "Log scale. Regression lines broken by month",
caption = "Source: Johns Hopkins CSSE"
)
ggsave(here("figures", "covid_19_confirmed_from15feb.png"), height = 20, width = 25, units = "cm", dpi = 300)
