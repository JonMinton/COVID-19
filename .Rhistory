slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit))
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results)
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope))
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) +
ggplot(aes(x = r_squared, y = slope)) +
geom_point()
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope)) +
geom_point()
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point()
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend_title = element_blank())
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend.title = element_blank())
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend.position = "none")
pacman::p_load(tidyverse, here, ggrepel)
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend.position = "none") +
geom_label_repel(aes(label = higher))
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
filter(higher != "Others") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend.position = "none") +
geom_label_repel(aes(label = higher))
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
filter(higher != "Others") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend.position = "none") +
geom_label_repel(aes(label = higher), alpha = 1)
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
filter(higher != "Others") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend.position = "none") +
geom_text_repel(aes(label = higher), alpha = 1)
get_gradient_fit <- function(dta){
num_cases <- dta %>%
filter(date == max(date)) %>%
pull(n)
model <- lm(log(n) ~ date, data = dta)
slope <- coefficients(model)[["date"]]
rsq <- summary(model)$r.squared
return(tibble(
num_cases, slope = slope, r_squared = rsq
))
}
tidied_data %>%
filter(date >= lubridate::dmy("29-02-20")) %>%
filter(higher %in% big_case_countries) %>%
filter(type == "confirmed") %>%
filter(higher != "Others") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
group_by(higher) %>% nest() %>%
mutate(results = map(data, get_gradient_fit)) %>%
select(higher, results) %>%
unnest(results) %>%
arrange(desc(slope)) %>%
ggplot(aes(x = r_squared, y = slope, alpha = log(num_cases))) +
geom_point() +
theme(legend.position = "none") +
geom_text_repel(aes(label = higher), alpha = 1) +
labs(
x = "R-squared (Higher= more log-linear)",
y = "Slope (Higher= faster % growth rates)",
title = "Steepness of case growth rate against model fit",
subtitle = "Countries with at least 100 cases on 8 March 2020. Darker dots = More cases",
caption = "Source: Johns Hopkins CSSE"
)
ggsave(here("figures", "rate_of_increase_against_model_fit.png"), height = 15, width = 15, units = "cm", dpi = 300)
tidied_data %>%
mutate(is_china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, is_china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y =  n, group = is_china, linetype = is_china)) +
facet_wrap(~type) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) + labs(
x = "Date", y = "Number of cases (Log scale)",
title = "Confirmed cases, deaths, and recovered",
subtitle = "China and elsewhere",
caption = "Source: Johns Hopkins CSSE"
)
tidied_data %>%
mutate(is_china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, is_china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y =  n, group = is_china, linetype = is_china)) +
facet_wrap(~type) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) + labs(
x = "Date", y = "Number of cases (Log scale)",
title = "Confirmed cases, deaths, and recovered",
subtitle = "China and elsewhere",
caption = "Source: Johns Hopkins CSSE"
) +
scale_linetype_discrete("Location")
tidied_data %>%
mutate(is_china = ifelse(higher == "Mainland China", "China", "Elsewhere")) %>%
group_by(date, is_china, type) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y =  n, group = is_china, linetype = is_china)) +
facet_wrap(~type) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) + labs(
x = "Date", y = "Number of cases (Log scale)",
title = "Confirmed cases, deaths, and recovered",
subtitle = "China and elsewhere",
caption = "Source: Johns Hopkins CSSE"
) +
scale_linetype_discrete("Location")
ggsave(here("figures", "confirmed_deaths_recovered.png"), height = 15, width = 20, units = "cm", dpi = 300)
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = n, group = higher, colour = higher == "Mainland China")) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) + labs(
x = "Date", y = "Number of cases (Log scale)",
title = "Confirmed cases by country",
caption = "Source: Johns Hopkins CSSE"
)
# Countries with at least 100 confirmed cases on 8/3/20
big_case_countries <-
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup()  %>%
filter(date == max(date)) %>%
arrange(desc(n)) %>%
filter(n > 100) %>%
pull(higher)
tidied_data %>%
mutate(country = case_when(
higher %in% big_case_countries ~ higher,
TRUE                           ~ "Other"
)
) %>%
filter(type == "confirmed") %>%
group_by(date, country) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = n)) +
geom_line() +
scale_y_log10() +
facet_wrap(~country)
# Countries with at least 100 confirmed cases on 8/3/20
big_case_countries <-
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup()  %>%
filter(date == max(date)) %>%
arrange(desc(n)) %>%
filter(n > 100) %>%
pull(higher)
tidied_data %>%
mutate(country = case_when(
higher %in% big_case_countries ~ higher,
TRUE                           ~ "Other"
)
) %>%
filter(type == "confirmed") %>%
group_by(date, country) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = n)) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
facet_wrap(~country)
# Countries with at least 100 confirmed cases on 8/3/20
big_case_countries <-
tidied_data %>%
filter(type == "confirmed") %>%
group_by(date, higher) %>%
summarise(n = sum(n)) %>%
ungroup()  %>%
filter(date == max(date)) %>%
arrange(desc(n)) %>%
filter(n > 100) %>%
pull(higher)
tidied_data %>%
mutate(country = case_when(
higher %in% big_case_countries ~ higher,
TRUE                           ~ "Other"
)
) %>%
filter(type == "confirmed") %>%
group_by(date, country) %>%
summarise(n = sum(n)) %>%
ungroup() %>%
ggplot(aes(x = date, y = n)) +
geom_line() +
scale_y_log10(
breaks = scales::trans_breaks("log10", function(x) 10^x),
labels = scales::trans_format("log10", scales::math_format(10^.x))
) +
facet_wrap(~country)
ggsave(here("figures", "confirmed_cases_atleast100.png"), height = 25, width = 25, units = "cm", dpi = 300)
